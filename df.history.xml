<data-definition>
    <struct-type type-name='historical_figure' instance-vector='$global.world.world_data.history.figures' key-field='id'>
        <enum base-type='int32_t' name='profession' type-name='profession'/>

        <int16_t name='race' ref-target='creature_raw'/>
        <int16_t name='sex' comment='-1 n/a, 0 female, 1 male'/>

        <int8_t/>
        <int32_t name='age_death'/>
        <int32_t name='appeared_year'/>
        <int32_t name='born_year'/>
        <int32_t/>

        <compound type-name='language_name' name='name'/>

        <code-helper name='describe'>
            (describe-obj $.name)
            (awhen (find-creature $.race)
              (fmt "(~A)" $it.creature_id))
        </code-helper>

        <df-flagarray name='flags'/>

        <int32_t name='unit_id' ref-target='unit'/>
        <int32_t name='id'/>

        <int32_t/>

        <stl-vector> corresponds to entity_links in modern versions
            <pointer>
                <int16_t/>
                <int32_t/>
                <int16_t/>
            </pointer>
        </stl-vector>
        <stl-vector> corresponds to site_links in modern versions
            <pointer>
                <int16_t/>
                <int32_t/>
                <int32_t/>
            </pointer>
        </stl-vector>
        <stl-vector> corresponds to histfig_links in modern versions
            <pointer>
                <int16_t/>
                <int32_t/>
            </pointer>
        </stl-vector>
    </struct-type>

    <enum-type type-name='history_event_type'>
        <enum-item name='WAR_ATTACKED_SITE'/>
        <enum-item name='WAR_DESTROYED_SITE'/>
        <enum-item name='CREATED_SITE'/>
        <enum-item name='HIST_FIGURE_DIED'/>
        <enum-item name='ADD_HF_ENTITY_LINK'/>
        <enum-item name='FIRST_CONTACT'/>
        <enum-item name='FIRST_CONTACT_FAILED'/>
        <enum-item name='TOPICAGREEMENT_CONCLUDED'/>
        <enum-item name='TOPICAGREEMENT_REJECTED'/>
        <enum-item name='TOPICAGREEMENT_MADE'/>
        <enum-item name='WAR_PEACE_ACCEPTED'/>
        <enum-item name='WAR_PEACE_REJECTED'/>
        <enum-item name='DIPLOMAT_LOST'/>
        <enum-item name='AGREEMENTS_VOIDED'/>
        <enum-item name='MERCHANT'/>
        <enum-item name='ARTIFACT_HIDDEN'/>
        <enum-item name='ARTIFACT_POSSESSED'/>
        <enum-item name='ARTIFACT_CREATED'/>
        <enum-item name='ARTIFACT_LOST'/>
        <enum-item name='ARTIFACT_FOUND'/>
        <enum-item name='ARTIFACT_RECOVERED'/>
        <enum-item name='ARTIFACT_DROPPED'/>
        <enum-item name='DEMON_ENCASED'/>
        <enum-item name='DEMON_RELEASED'/>
        <enum-item name='RECLAIM_SITE'/>
        <enum-item name='CONTACT_LIST'/>
        <enum-item name='HF_DESTROYED_SITE'/>
        <enum-item name='SITE_DIED'/>
        <enum-item name='SITE_ABANDONED'/>
    </enum-type>

    <class-type type-name='history_event' original-name='history_eventst'
                instance-vector='$global.world.world_data.history.events' key-field='id'>
        <int32_t name='year'/>
        <int8_t name='season'/>
        <int16_t name='season_ticks'/>
        <df-flagarray name='flags'/>
        <int32_t name='id'/>

        <virtual-methods>
            <vmethod ret-type='history_event_type' name='getType'/>
            <vmethod name='getWarStatus'/>
            <vmethod name='getAngerModifier'/>
            <vmethod name='getHappinessModifier'/>
            <vmethod name='madeFirstContact'/>

            <vmethod name='wasArtifactHidden'/>
            <vmethod name='getArtifactMakerUnitID'/>
            <vmethod name='isArtifactPossessedByUnit'/>
            <vmethod name='associateArtifactWithUnit'/>
            <vmethod name='getKilledHistfigID'/>

            -- 10

            <vmethod name='wasHistfigKilled'/>
            <vmethod name='getEncasedDemonHistfigID'/>
            <vmethod name='getEncasedDemonRegionID'/>
            <vmethod name='getRelatedHistfigIDs'/>
            <vmethod name='getRelatedSiteIDs'/>

            <vmethod name='getRelatedArtifactIDs'/>
            <vmethod name='getRelatedRegionIDs'/>
            <vmethod name='getRelatedEntityIDs'/>
            <vmethod name='isRelatedToHistfigID'/>
            <vmethod name='isRelatedToSiteID'/>

            -- 20

            <vmethod name='isRelatedToArtifactID'/>
            <vmethod name='isRelatedToRegionID'/>
            <vmethod name='isRelatedToEntityID'/>
            <vmethod name='getSummary'/> "In x, some event happened"
            <vmethod name='getDescription'/> "the happening of some event"

            <vmethod name='populateArtImage'/>
            <vmethod name='write_file'> <pointer comment='file_compressorst'/> </vmethod>
            <vmethod name='read_file'>
                <pointer comment='file_compressorst'/>
                <int32_t name='loadversion'/>
            </vmethod>
            <vmethod is-destructor='true'/>
        </virtual-methods>
    </class-type>

    <class-type type-name='history_event_war_attacked_sitest' inherits-from='history_event'>
        <int32_t name='attacker' ref-target='historical_entity'/>
        <int32_t name='defender_civ' ref-target='historical_entity'/>
        <int32_t name='defender_group' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_war_destroyed_sitest' inherits-from='history_event'>
        <int32_t name='attacker' ref-target='historical_entity'/>
        <int32_t name='defender_civ' ref-target='historical_entity'/>
        <int32_t name='defender_group' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_created_sitest' inherits-from='history_event'>
        <int32_t name='civ' ref-target='historical_entity'/>
        <int32_t name='group' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_hist_figure_diedst' inherits-from='history_event'>
        <int32_t name='victim' ref-target='historical_figure'/>
        <int32_t name='killer' ref-target='historical_figure'/>
        <int32_t name='site' ref-target='world_site'/>
        <int32_t name='region' ref-target='world_region'/>
        <int16_t name='death_cause'/>
    </class-type>

    <class-type type-name='history_event_add_hf_entity_linkst' inherits-from='history_event'>
        <int32_t name='entity' ref-target='historical_entity'/>
        <int32_t name='ruler' ref-target='historical_figure'/>
    </class-type>

    <class-type type-name='history_event_first_contactst' inherits-from='history_event'>
        <int32_t name='source' ref-target='historical_entity'/>
        <int32_t name='destination' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_first_contact_failedst' inherits-from='history_event'>
        <int32_t name='source' ref-target='historical_entity'/>
        <int32_t name='destination' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_topicagreement_concludedst' inherits-from='history_event'>
        <int32_t name='source' ref-target='historical_entity'/>
        <int32_t name='destination' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
        <int16_t name='agreement_type'/>
        <int32_t name='result'/>
    </class-type>

    <class-type type-name='history_event_topicagreement_rejectedst' inherits-from='history_event'>
        <int16_t name='agreement_type'/>
        <int32_t name='source' ref-target='historical_entity'/>
        <int32_t name='destination' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_topicagreement_madest' inherits-from='history_event'>
        <int16_t name='agreement_type'/>
        <int32_t name='source' ref-target='historical_entity'/>
        <int32_t name='destination' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_war_peace_acceptedst' inherits-from='history_event'>
        <int16_t/>
        <int32_t name='source' ref-target='historical_entity'/>
        <int32_t name='destination' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_war_peace_rejectedst' inherits-from='history_event'>
        <int16_t/>
        <int32_t name='source' ref-target='historical_entity'/>
        <int32_t name='destination' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_diplomat_lostst' inherits-from='history_event'>
        <int32_t name='entity' ref-target='historical_entity'/>
        <int32_t name='involved' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_agreements_voidedst' inherits-from='history_event'>
        <int32_t name='source' ref-target='historical_entity'/>
        <int32_t name='destination' ref-target='historical_entity'/>
    </class-type>

    <class-type type-name='history_event_merchantst' inherits-from='history_event'>
        <int32_t name='source' ref-target='historical_entity'/>
        <int32_t name='destination' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
        <df-flagarray name='flags'/>
    </class-type>

    <class-type type-name='history_event_artifact_hiddenst' inherits-from='history_event'>
        <int32_t name='artifact' ref-target='artifact_record'/>
        <int32_t name='unit' ref-target='unit'/>
        <int32_t name='histfig' ref-target='historical_figure'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_artifact_possessedst' inherits-from='history_event'>
        <int32_t name='artifact' ref-target='artifact_record'/>
        <int32_t name='unit' ref-target='unit'/>
        <int32_t name='histfig' ref-target='historical_figure'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_artifact_createdst' inherits-from='history_event'>
        <int32_t name='artifact' ref-target='artifact_record'/>
        <int32_t name='unit' ref-target='unit'/>
        <int32_t name='histfig' ref-target='historical_figure'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_artifact_lostst' inherits-from='history_event'>
        <int32_t name='artifact' ref-target='artifact_record'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_artifact_foundst' inherits-from='history_event'>
        <int32_t name='artifact' ref-target='artifact_record'/>
        <int32_t name='unit' ref-target='unit'/>
        <int32_t name='histfig' ref-target='historical_figure'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_artifact_recoveredst' inherits-from='history_event'>
        <int32_t name='artifact' ref-target='artifact_record'/>
        <int32_t name='unit' ref-target='unit'/>
        <int32_t name='histfig' ref-target='historical_figure'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_artifact_droppedst' inherits-from='history_event'>
        <int32_t name='artifact' ref-target='artifact_record'/>
        <int32_t/>
        <int32_t name='histfig' ref-target='historical_figure'/>
        <int32_t name='site' ref-target='world_site'/>
        <df-flagarray name='flags'/>
    </class-type>

    <class-type type-name='history_event_demon_encasedst' inherits-from='history_event'>
        <int32_t name='demon' ref-target='historical_figure'/>
        <int32_t name='region' ref-target='world_region'/>
    </class-type>

    <class-type type-name='history_event_demon_releasedst' inherits-from='history_event'>
        <int32_t name='demon' ref-target='historical_figure'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_reclaim_sitest' inherits-from='history_event'>
        <int32_t name='civ' ref-target='historical_entity'/>
        <int32_t name='group' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_contact_lostst' inherits-from='history_event'>
        <int32_t name='civ' ref-target='historical_entity'/>
        <int32_t name='group' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_hf_destroyed_sitest' inherits-from='history_event'>
        <int32_t name='histfig' ref-target='historical_figure'/>
        <int32_t name='civ' ref-target='historical_entity'/>
        <int32_t name='group' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_site_diedst' inherits-from='history_event'>
        <int32_t name='civ' ref-target='historical_entity'/>
        <int32_t name='group' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <class-type type-name='history_event_site_abandonedst' inherits-from='history_event'>
        <int32_t name='civ' ref-target='historical_entity'/>
        <int32_t name='group' ref-target='historical_entity'/>
        <int32_t name='site' ref-target='world_site'/>
    </class-type>

    <struct-type type-name='world_history'>
        <stl-vector name='events'>
            <pointer type-name='history_event'/>
        </stl-vector>

        <stl-vector name='figures'>
            <pointer type-name='historical_figure'/>
        </stl-vector>

        <stl-vector name='unk1' type-name='int32_t'/>
        <stl-vector name='unk2' type-name='int16_t'/>

        <int32_t/>
    </struct-type>
</data-definition>

<!--
Local Variables:
indent-tabs-mode: nil
nxml-child-indent: 4
End:
-->
